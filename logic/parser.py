import xml.etree.ElementTree as ET

def get_imports(filepath):
    file = open(filepath, "r", errors='replace')
    imports_list = []
    package_id = "!!!"
	
    for line in file:
        line = line.strip()
        if line.startswith("package "):
            package_name = line.split("package ")[1]
            pn_split = package_name.split(".")
            if len(pn_split) > 1:
                package_id = pn_split[0] + "." + pn_split[1]
            else:
                package_id = package_name
        if line.startswith("import "):
            import_name = line.split("import ")[1]
            
            if import_name.startswith("static "):
                import_name = import_name.split("static ")[1]
            if import_name[-1] == ';':
                import_name = import_name[:-1]
            if not import_name.startswith(package_id):
                imports_list.append(import_name)
    
    file.close()

    return imports_list

def get_permissions(filepath):
    permissions_list = []

    try:
        android_namespace = '{http://schemas.android.com/apk/res/android}'
        root = ET.parse(filepath).getroot()

        permissions = root.findall('uses-permission')
        for perm in permissions:
            for att in perm.attrib:
                if att == android_namespace+"name":
                    permissions_list.append(perm.attrib[att])

        permissions = root.findall('uses-feature')
        for perm in permissions:
            for att in perm.attrib:
                if att == android_namespace+"name":
                    permissions_list.append(perm.attrib[att])

        services = root.findall('application/service')
        for perm in services:
            for att in perm.attrib:
                if att == android_namespace+"permission":
                    permissions_list.append(perm.attrib[att])
        
        receivers = root.findall('application/receiver')
        for perm in receivers:
            for att in perm.attrib:
                if att == android_namespace+"permission":
                    permissions_list.append(perm.attrib[att])

        permissions = root.findall('application/*/intent-filter/action')
        for perm in permissions:
            for att in perm.attrib:
                if att == android_namespace+"name":
                    permissions_list.append(perm.attrib[att])

    except ET.ParseError:
        pass

    return permissions_list